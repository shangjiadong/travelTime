<!DOCTYPE html>
<html lang = "en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Reachability</title>
    <!-- Bootstrap Core CSS -->
    <!--<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">-->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/modern-business.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="assets/favicon/travelTimeIcon3.ico" type="image/x-icon">

    <!--  Include jquery - required for XHR requests -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!--  Include leaflet javascript and css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" crossorigin=""></script>
    <!--  Include r360.js -->
    <script src="https://releases.route360.net/r360-js/latest.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!--  Include leaflet javascript and css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" crossorigin=""></script>
    <!--  Include angular stuff  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.9/angular-material.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.9/angular-material.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular-animate.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular-aria.js"></script>
    <!--  Include r360.js and angular plugin -->
    <script src="https://releases.route360.net/r360-js/latest.js"></script>
    <script src="https://releases.route360.net/r360-angular/latest.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        html, body { width: 100%; height: 100%; margin: 0; font-family: sans-serif; }
        #map { width: 100%; height: 100%; }
        .controls { position: absolute; bottom: 40px; left: 0px; right: 0px; z-index: 1000}
        .button-group {
            position: absolute; right: 10px; top: 65px; z-index: 1000;
            box-shadow: 0 1px 5px rgba(0,0,0,.4); background-color: rgba(255,255,255,1);
        }
        .button {
            font-family: sans-serif; text-transform: uppercase;
            color: #666; cursor: pointer; padding: 10px; display: inline-block;
        }
        .button:hover { background-color: #EEE; }
        .button.active { color: rgb(63,81,181); }
        r360-rainbow { width: 420px; margin: auto; }
        r360-rainbow label {
            display: inline-block;
            font-size: 13px;
            margin: 0;
            padding: .5rem 0;
            text-align: center;
            color: rgba(255,255,255,.8);
        }
    </style>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">
                <img src="img/travelTimeIcon3.png" class="align-top" height="25px" align="left"> &nbsp; &nbsp; &nbsp;TransNetReach
            </a>
        </div>


        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="index.html">Home</a>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Scenario <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="singleSource.html">Single Origin</a>
                        </li>
                        <li>
                            <a href="multiSource.html">Multiple Origins</a>
                        </li>

                    </ul>
                </li>
                <li>
                    <a href="about.html">About</a>
                </li>
                <!--<li>-->
                <!--<a href="services.html">Map</a>-->
                <!--</li>-->
                <li class = 'button'>
                    <dt>
                        <!--facebook icon-->
                        <a class="fa fa-facebook-square btn fa-lg"
                           href="https://www.facebook.com/sharer/sharer.php?u=https%3A//shangjiadong.github.io/travelTime/"
                           target="_blank"></a>
                    </dt>
                </li>
                <li class = 'button'>
                    <dt>
                        <!--facebook icon-->
                        <a class="fa fa-github btn fa-lg" href="https://github.com/shangjiadong/travelTime"
                           target="_blank"></a>
                    </dt>
                </li>
                <li class = 'button'>
                    <dt>
                        <!--facebook icon-->
                        <a class="fa fa-user btn fa-lg" href="http://people.oregonstate.edu/~dongs/"
                           target="_blank"></a>
                    </dt>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


<!--  where the map will live  -->
<div id="map"></div>
<div id="selectionBar" class="button-group">
    <div id="btn-walk" onclick="changeMode(&apos;walk&apos;)" class="button"><i class="material-icons">directions_walk</i></div>
    <div id="btn-bike" onclick="changeMode(&apos;bike&apos;)" class="button"><i class="material-icons">directions_bike</i></div>
    <div id="btn-car" onclick="changeMode(&apos;car&apos;)" class="button active"><i class="material-icons">directions_car</i></div>
    <div id="btn-transit" onclick="changeMode(&apos;transit&apos;)" class="button"><i class="material-icons">directions_transit</i></div>
</div>

<div ng-app="RainbowExample" ng-controller="RainbowExampleController as vm" class="controls" ng-cloak="" layout="column" layout-align="start end">
    <r360-rainbow travel-time="vm.rainbowConf.travelTime" travel-time-range="vm.rainbowConf.range" color-range="vm.rainbowConf.colorRange">
    </r360-rainbow>
</div>

<script>
    var defaultApiKey = 'Q636WS2YQD7CLSB01BORJAA';
    var mapboxMapID = 'mi.0ad4304c';
    var mapboxPublicKey = 'pk.eyJ1IjoibWkiLCJhIjoia1RPVl9ZcyJ9.WrySAsiu-KvK9eYcMScLFQ';
</script>
<script>
    angular.module('RainbowExample', ['ngMaterial', 'ng360'])
        .controller("RainbowExampleController", function() {

            var vm = this;
            vm.rainbowConf = {
                range: {times: [10, 20, 30]},
                travelTime: 30,
                colorRange: {
                    "name": "Colorblind",
                    "id": 1,
//                    "colors": ["#142b66", "#9527BC", "#DF2A5C"],
                    "colors": ["#2c7bb6", "#fdae61", "#d7191c"],
                    "opacities": [1, 1, 1, 1, 1, 1]
                }
            };
        });
    var travelMode = 'car';
    var latlon = [45.5259, -122.685];

    var map = L.map('map', {zoomControl: false}).setView(latlon, 12);
    map.attributionControl.addAttribution("<a href='https://navitia.opendatasoft.com/explore/dataset/us-or/table/' target='_blank'>GTFS Data</a>");
    map.attributionControl.addAttribution("<a href='http://people.oregonstate.edu/~dongs/' target='_blank'>Shangjia Dong</a>");

    L.control.zoom({position: 'bottomleft'}).addTo(map);

    // initialise the base map
    r360.basemap({style: 'basic', apikey: defaultApiKey}).addTo(map);

    // create a source and a two target markers and add them to the map
    var sourceMarker = L.marker(latlon, {draggable: true}).addTo(map);

    // create the layer to add the polygons
    var polygonLayer = r360.leafletPolygonLayer().addTo(map);

    // helper function to encapsulate the show polygon action
    polygonLayer.setColors([
        { 'time':  600, 'opacity': 1, 'color': '#2c7bb6' },
        { 'time': 1200, 'opacity': 1, 'color': '#fdae61' },
        { 'time': 1800, 'opacity': 1, 'color': '#d7191c' },
    ]);
    var showPolygons = function () {
        var travelOptions = r360.travelOptions();
        // add the predefined source to the map
        travelOptions.addSource(sourceMarker);
        // add some travel time values
        travelOptions.setTravelTimes([600, 1200, 1800]);
        // set inital travel time
        travelOptions.setTravelType(travelMode);
        // set the service API-key
        travelOptions.setServiceKey(defaultApiKey);
        // set the service url for your area
        travelOptions.setServiceUrl('https://service.route360.net/northamerica/');

        // call the service
        r360.PolygonService.getTravelTimePolygons(travelOptions, function (polygons) {
            // in case there are already polygons on the map/layer clear them
            polygonLayer.clearAndAddLayers(polygons, true);
        });
    };

    // call the helper function to display polygons with initial value
    showPolygons();
    // re-run the polygons when we move a marker
    sourceMarker.on('dragend', function () {
        showPolygons(true);
    });

    // change polygons on button click
    var changeMode = function (value) {
        travelMode = value;
        $("#selectionBar .active").removeClass('active');
        $("#btn-" + value).addClass('active');
        showPolygons();
    }

</script>

<!-- jQuery -->
<script src="js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<!-- Contact Form JavaScript -->
<!-- Do not edit these files! In order to set the email address and subject line for the contact form go to the bin/contact_me.php file. -->
<script src="js/jqBootstrapValidation.js"></script>
<script src="js/contact_me.js"></script>

</body>
</html>
